<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DipDarks Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
        }

        .terminal-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        .terminal-header {
            background: #333;
            padding: 10px;
            border-bottom: 2px solid #00ff00;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-controls {
            display: flex;
            gap: 5px;
        }

        .control-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        .close {
            background: #ff5f56;
        }

        .minimize {
            background: #ffbd2e;
        }

        .maximize {
            background: #27ca3f;
        }

        .terminal-title {
            color: #ccc;
            font-size: 14px;
            margin-left: 10px;
        }

        .terminal-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.8);
        }

        .output-line {
            margin-bottom: 5px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .error {
            color: #ff6b6b;
        }

        .success {
            color: #51cf66;
        }

        .info {
            color: #74c0fc;
        }

        .prompt {
            color: #00ff00;
            font-weight: bold;
        }

        .input-line {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .prompt-symbol {
            color: #00ff00;
            margin-right: 5px;
            font-weight: bold;
        }

        .command-input {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: inherit;
            font-size: inherit;
            outline: none;
            flex: 1;
            caret-color: #00ff00;
        }

        .cursor {
            background: #00ff00;
            color: #1a1a1a;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0;
            }
        }

        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 5px;
            margin: 10px 0;
        }

        .file-item {
            color: #74c0fc;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: rgba(116, 192, 252, 0.1);
        }

        .directory {
            color: #ffd43b;
            font-weight: bold;
        }

        .editor-mode {
            background: rgba(0, 20, 0, 0.9);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }

        .editor-header {
            color: #ffd43b;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .editor-content {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: inherit;
            font-size: inherit;
            outline: none;
            width: 100%;
            min-height: 200px;
            resize: vertical;
        }
    </style>
</head>

<body>
    <div class="terminal-container">
        <div class="terminal-header">
            <div class="terminal-controls">
                <button class="control-btn close"></button>
                <button class="control-btn minimize"></button>
                <button class="control-btn maximize"></button>
            </div>
            <div class="terminal-title">DipDarks Terminal - user@dipdarks:~</div>
        </div>
        <div class="terminal-body" id="terminal">
            <div class="output-line prompt">Welcome to DipDarks Terminal v1.0</div>
            <div class="output-line info">Type 'help' to see available commands</div>
            <div class="input-line">
                <span class="prompt-symbol">user@dipdarks:~$</span>
                <input type="text" class="command-input" id="commandInput" autocomplete="off" spellcheck="false">
            </div>
        </div>
    </div>

    <script>
        class FileSystem {
            constructor() {
                this.currentPath = '/home/user';
                this.files = {
                    '/': {
                        type: 'directory',
                        children: ['home', 'etc', 'var', 'tmp']
                    },
                    '/home': {
                        type: 'directory',
                        children: ['user']
                    },
                    '/home/user': {
                        type: 'directory',
                        children: ['documents', 'downloads', 'projects', 'notes.txt', 'readme.md']
                    },
                    '/home/user/documents': {
                        type: 'directory',
                        children: ['report.txt', 'presentation.md']
                    },
                    '/home/user/downloads': {
                        type: 'directory',
                        children: []
                    },
                    '/home/user/projects': {
                        type: 'directory',
                        children: ['website', 'app.js']
                    },
                    '/home/user/projects/website': {
                        type: 'directory',
                        children: ['index.html', 'style.css', 'script.js']
                    },
                    '/home/user/notes.txt': {
                        type: 'file',
                        content: 'Personal notes:\n- Learn JavaScript\n- Build web terminal\n- Practice coding\n'
                    },
                    '/home/user/readme.md': {
                        type: 'file',
                        content: '# Welcome to Web Terminal\n\nThis is a basic file system emulator.\nYou can navigate and edit files here.\n'
                    },
                    '/home/user/documents/report.txt': {
                        type: 'file',
                        content: 'Monthly Report\n=============\n\nProgress made on various projects...\n'
                    },
                    '/home/user/projects/app.js': {
                        type: 'file',
                        content: 'console.log("Hello, World!");\n\n// TODO: Add more functionality\n'
                    }
                };
            }

            getCurrentDir() {
                return this.files[this.currentPath];
            }

            getAbsolutePath(path) {
                if (path.startsWith('/')) return path;
                if (path === '..') {
                    const parts = this.currentPath.split('/').filter(p => p);
                    parts.pop();
                    return '/' + parts.join('/') || '/';
                }
                if (path === '.') return this.currentPath;
                return this.currentPath === '/' ? `/${path}` : `${this.currentPath}/${path}`;
            }

            exists(path) {
                return this.files.hasOwnProperty(path);
            }

            isDirectory(path) {
                return this.exists(path) && this.files[path].type === 'directory';
            }

            isFile(path) {
                return this.exists(path) && this.files[path].type === 'file';
            }

            getFileContent(path) {
                return this.isFile(path) ? this.files[path].content : null;
            }

            setFileContent(path, content) {
                if (this.isFile(path)) {
                    this.files[path].content = content;
                    return true;
                }
                return false;
            }

            createFile(path, content = '') {
                if (!this.exists(path)) {
                    this.files[path] = { type: 'file', content };
                    // Add to parent directory
                    const parentPath = path.substring(0, path.lastIndexOf('/')) || '/';
                    const fileName = path.substring(path.lastIndexOf('/') + 1);
                    if (this.isDirectory(parentPath)) {
                        this.files[parentPath].children.push(fileName);
                    }
                    return true;
                }
                return false;
            }
        }

        class Terminal {
            constructor() {
                this.fs = new FileSystem();
                this.history = [];
                this.historyIndex = -1;
                this.editorMode = false;
                this.editingFile = null;
                this.commands = {
                    help: () => this.showHelp(),
                    ls: (args) => this.listFiles(args),
                    pwd: () => this.printWorkingDirectory(),
                    cd: (args) => this.changeDirectory(args),
                    cat: (args) => this.showFileContent(args),
                    edit: (args) => this.editFile(args),
                    touch: (args) => this.createFile(args),
                    clear: () => this.clearTerminal(),
                    whoami: () => this.addOutput('user'),
                    date: () => this.addOutput(new Date().toString()),
                    echo: (args) => this.addOutput(args.join(' ')),
                    mkdir: (args) => this.makeDirectory(args)
                };
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                const input = document.getElementById('commandInput');
                input.addEventListener('keydown', (e) => this.handleKeydown(e));
                input.focus();
            }

            handleKeydown(e) {
                const input = e.target;

                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (this.editorMode) {
                        this.exitEditor();
                    } else {
                        this.executeCommand(input.value.trim());
                        input.value = '';
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    this.navigateHistory(-1);
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    this.navigateHistory(1);
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    // Simple tab completion could be added here
                }
            }

            navigateHistory(direction) {
                if (this.history.length === 0) return;

                this.historyIndex += direction;
                this.historyIndex = Math.max(-1, Math.min(this.history.length - 1, this.historyIndex));

                const input = document.getElementById('commandInput');
                input.value = this.historyIndex >= 0 ? this.history[this.historyIndex] : '';
            }

            executeCommand(cmdLine) {
                if (!cmdLine) return;

                this.history.unshift(cmdLine);
                this.historyIndex = -1;

                this.addOutput(`${this.getPrompt()}${cmdLine}`, 'prompt');

                const [cmd, ...args] = cmdLine.split(' ');
                const command = this.commands[cmd.toLowerCase()];

                if (command) {
                    command(args);
                } else {
                    this.addOutput(`Command not found: ${cmd}`, 'error');
                }

                this.scrollToBottom();
            }

            getPrompt() {
                const shortPath = this.fs.currentPath.replace('/home/user', '~');
                return `user@dipdarks:${shortPath}$ `;
            }

            addOutput(text, className = '') {
                const terminal = document.getElementById('terminal');
                const line = document.createElement('div');
                line.className = `output-line ${className}`;
                line.textContent = text;

                // Insert before the input line
                const inputLine = terminal.querySelector('.input-line');
                terminal.insertBefore(line, inputLine);
            }

            scrollToBottom() {
                const terminal = document.getElementById('terminal');
                terminal.scrollTop = terminal.scrollHeight;
            }

            updatePrompt() {
                const promptSymbol = document.querySelector('.prompt-symbol');
                promptSymbol.textContent = this.getPrompt();
            }

            // Command implementations
            showHelp() {
                const helpText = [
                    'Available commands:',
                    '  help     - Show this help message',
                    '  ls       - List directory contents',
                    '  pwd      - Print working directory',
                    '  cd       - Change directory',
                    '  cat      - Display file contents',
                    '  edit     - Edit a file (press Enter to save and exit)',
                    '  touch    - Create a new file',
                    '  mkdir    - Create a directory',
                    '  clear    - Clear the terminal',
                    '  whoami   - Show current user',
                    '  date     - Show current date and time',
                    '  echo     - Display text'
                ];
                helpText.forEach(line => this.addOutput(line, 'info'));
            }

            listFiles(args) {
                const showHidden = args.includes('-a');
                const longFormat = args.includes('-l');
                const currentDir = this.fs.getCurrentDir();

                if (!currentDir || currentDir.type !== 'directory') {
                    this.addOutput('Not a directory', 'error');
                    return;
                }

                const files = currentDir.children || [];
                if (files.length === 0) {
                    this.addOutput('Directory is empty');
                    return;
                }

                files.forEach(file => {
                    const fullPath = this.fs.getAbsolutePath(file);
                    const isDir = this.fs.isDirectory(fullPath);
                    const className = isDir ? 'directory' : 'file-item';
                    const prefix = isDir ? 'd' : '-';
                    const display = longFormat ? `${prefix}rwxr-xr-x 1 user user 0 Jan 1 00:00 ${file}` : file;
                    this.addOutput(display, className);
                });
            }

            printWorkingDirectory() {
                this.addOutput(this.fs.currentPath);
            }

            changeDirectory(args) {
                if (args.length === 0) {
                    this.fs.currentPath = '/home/user';
                    this.updatePrompt();
                    return;
                }

                const targetPath = this.fs.getAbsolutePath(args[0]);

                if (!this.fs.exists(targetPath)) {
                    this.addOutput(`cd: no such file or directory: ${args[0]}`, 'error');
                    return;
                }

                if (!this.fs.isDirectory(targetPath)) {
                    this.addOutput(`cd: not a directory: ${args[0]}`, 'error');
                    return;
                }

                this.fs.currentPath = targetPath;
                this.updatePrompt();
            }

            showFileContent(args) {
                if (args.length === 0) {
                    this.addOutput('cat: missing file operand', 'error');
                    return;
                }

                const filePath = this.fs.getAbsolutePath(args[0]);
                const content = this.fs.getFileContent(filePath);

                if (content === null) {
                    this.addOutput(`cat: ${args[0]}: No such file or directory`, 'error');
                    return;
                }

                content.split('\n').forEach(line => this.addOutput(line));
            }

            editFile(args) {
                if (args.length === 0) {
                    this.addOutput('edit: missing file operand', 'error');
                    return;
                }

                const filePath = this.fs.getAbsolutePath(args[0]);
                let content = this.fs.getFileContent(filePath);

                if (content === null) {
                    // Create new file if it doesn't exist
                    content = '';
                    this.fs.createFile(filePath, content);
                }

                this.enterEditor(filePath, content);
            }

            enterEditor(filePath, content) {
                this.editorMode = true;
                this.editingFile = filePath;

                const terminal = document.getElementById('terminal');
                const inputLine = terminal.querySelector('.input-line');

                const editorDiv = document.createElement('div');
                editorDiv.className = 'editor-mode';
                editorDiv.innerHTML = `
                    <div class="editor-header">Editing: ${filePath} (Press Enter to save and exit)</div>
                    <textarea class="editor-content" id="editorContent">${content}</textarea>
                `;

                terminal.insertBefore(editorDiv, inputLine);
                document.getElementById('editorContent').focus();
            }

            exitEditor() {
                const content = document.getElementById('editorContent').value;
                this.fs.setFileContent(this.editingFile, content);

                document.querySelector('.editor-mode').remove();
                this.addOutput(`File saved: ${this.editingFile}`, 'success');

                this.editorMode = false;
                this.editingFile = null;
                document.getElementById('commandInput').focus();
            }

            createFile(args) {
                if (args.length === 0) {
                    this.addOutput('touch: missing file operand', 'error');
                    return;
                }

                const filePath = this.fs.getAbsolutePath(args[0]);
                if (this.fs.createFile(filePath)) {
                    this.addOutput(`Created file: ${args[0]}`, 'success');
                } else {
                    this.addOutput(`touch: cannot create file '${args[0]}': File exists`, 'error');
                }
            }

            makeDirectory(args) {
                if (args.length === 0) {
                    this.addOutput('mkdir: missing operand', 'error');
                    return;
                }

                // Basic implementation - would need more work for full functionality
                this.addOutput(`mkdir: ${args[0]}: Operation not fully implemented`, 'error');
            }

            clearTerminal() {
                const terminal = document.getElementById('terminal');
                const inputLine = terminal.querySelector('.input-line');
                terminal.innerHTML = '';
                terminal.appendChild(inputLine);
            }
        }

        // Initialize terminal when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new Terminal();
        });
    </script>
</body>

</html>